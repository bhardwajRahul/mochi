package main

import (
	_ "mochi/runtime/llm/provider/echo"
	"context"
	"fmt"
	"mochi/runtime/llm"
	"strings"
)

func main() {
	var poem string = _genText("echo $word", _toAnyMap(map[string]string{"word": "hello"}))
	fmt.Println(poem)
}

func _genText(prompt string, args map[string]any) string {
    for k, v := range args {
        placeholder := "$" + k
        prompt = strings.ReplaceAll(prompt, placeholder, fmt.Sprintf("%v", v))
    }
    resp, err := llm.Chat(context.Background(), []llm.Message{{Role: "user", Content: prompt}})
    if err != nil { panic(err) }
    return resp.Message.Content
}

func _toAnyMap(m any) map[string]any {
    switch v := m.(type) {
    case map[string]any:
        return v
    case map[string]string:
        out := make(map[string]any, len(v))
        for k, vv := range v {
            out[k] = vv
        }
        return out
    default:
        return nil
    }
}
